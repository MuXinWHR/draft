
##交换机基础

背板带宽指的是背板整个的交换容量，交换容量指cpu的交换容量，包转发指的是三层转发的容量


##线速

考察交换机上所有端口能提供的总带宽。计算公式为端口数*相应端口速率*2（全双工模式）
如果总带宽≤标称背板带宽，那么在背板带宽上是线速的。

###第二层包转发线速

第二层包转发率=千兆端口数量×1.488Mpps+百兆端口数量*0.1488Mpps+其余类型端口数*相应计算方法，如果这个速率能≤标称
二层包转发速率，那么交换机在做第二层交换的时候可以做到线速。

###第三层包转发线速

同上

如果能满足上面三个条件，那么我们就说这款交换机真正做到了线性无阻塞

###1.488Mpps是怎么得到的呢?

* 对于万兆以太网，一个线速端口的包转发率为14.88Mpps。
* 对于千兆以太网，一个线速端口的包转发率为1.488Mpps。
* 对于快速以太网，一个线速端口的包转发率为0.1488Mpps。
* 对于OC－12的POS端口，一个线速端口的包转发率为1.17Mpps。
* 对于OC－48的POS端口，一个线速端口的包转发率为4.68MppS。

以太网传输最小包长就是 64 字节、POS 口是 40 字节。包转发线速的衡量标准是以单位时间内发送 64byte 的数据包(最小包)
的个数作为计算基准的。对于千兆以太网来说，计算方法如下：

    1,000,000,000bps/8bit/(64+8+12)byte = 1,488,095pps

说明：当以太网帧为 64byte 时，需考虑 8byte 的帧头和 12byte 的帧间隙的固定开销。故一个线速的千兆以太网端口在转发
64byte 包时的包转发率为 1.488Mpps。快速以太网的线速端口包转发率正好为千兆以太网的十分之一，为 148.8kpps（0.1488Mpps）。

##端口总速率

每个帧头都要加上了 8 个字节的前导符，前导符的作用在于告诉监听设备数据将要到来。然后，以太网中的每个帧之间都要有帧间隙，
即每发完一个帧之后要等待一段时间再发另外一个帧，在以太网标准中规定最小是 12 个字节，然而帧间隙在实际应用中有可能会比
12 个字节要大，在这里我用了最小值。每个帧都要有 20 个字节的固定开销，我们再来算一下交换机单个端口的实际吞吐量：

    148，809×(64+8+12)×8≈100Mbps，

通过这个公式不难看出，真正的数据交换量占到 64/84=76%，交换机端口链路的"线速"数据吞吐量实际上只有 76Mbps，另外一部分被
用来处理了额外的开销，这两者加起来才是标准的百兆或者千兆


##内部结构

背板带宽资源的利用率与交换机的内部结构息息相关。交换机的内部结构主要有以下几种：

一是共享内存结构，这种结构依赖中心交换引擎来提供全端口的高性能连接，由核心引擎检查每个输入包以决定路由。这种方法需要很
大的内存带宽、很高的管理费用，尤其是随着交换机端口的增加，中央内存的价格会很高，因而交换机内核成为性能实现的瓶颈；

二是交叉总线结构，它可在端口间建立直接的点对点连接，这对于单点传输性能很好，但不适合多点传输；

三是混合交叉总线结构，这是一种混合交叉总线实现方式，它的设计思路是，将一体的交叉总线矩阵划分成小的交叉矩阵，中间通过一
条高性能的总线连接。其优点是减少了交叉总线数，降低了成本，减少了总线争用；但连接交叉矩阵的总线成为新的性能瓶颈。

##工作原理

首先，要先了解为什么要有 CSMA 这个技术，因为传统的总线型以太网络里线路是共享的，收发在一条线路上，所以需要在发包之前侦听
一下，就好像双向单车道，上路前要观望一下；而双工链路是收发独立的，就好像是双向双车道，大家都是同一个方向，不存在冲突的可能；
再回到题主的问题，在交换机内部也是收发独立的，转发芯片、phy芯片都是两个方向的，所以可以实现全双工；再加上目前绝大多数普通交
换机都是存储转发，收到的报文先存储，再查表转发，多个入口到同一个出口的报文存在先后顺序，这样就不会出现 hub 的冲突情况了。为
了避免多到一造成的拥塞，在出方向还有相应的拥塞调度机制保证。




###集线器VS交换机

ISO/RM 开放体系模型中对应的层次就不一样，集线器是工作在第一层（物理层），而交换机至少是工作在第二层，更高级的交换机可以
工作在第三层（网络层）和第四层（传输层）。


* 交换机的数据传输方式不同 

集线器的数据传输方式是广播（broadcast）方式，而交换机的数据传输是有目的的，数据只对目的节点发送，只是在自己的 MAC 地址表
中找不到的情况下第一次使用广播方式发送，然后因为交换机具有 MAC 地址学习功能，第二次以后就不再是广播发送了，又是有目的的发
送。这样的好处是数据传输效率提高，不会出现广播风暴，在安全性方面也不会出现其它节点侦听的现象。用集线器组成的网络称为共享
式网络，而用交换机组成的网络称为交换式网络。

共享式以太网存在的主要问题是所有用户共享带宽，每个用户的实际可用带宽随网络用户数的增加而递减。这是因为当信息繁忙时，多个
用户可能同时“争用”一个信道，而一个信道在某一时刻只允许一个用户占用，所以大量的用户经常处于监测等待状态，致使信号传输时产
生抖动、停滞或失真，严重影响了网络的性能。

* 带宽占用方式不同

在带宽占用方面，集线器所有端口是共享集线器的总带宽，而交换机的每个端口都具有自己的带宽，这样就交换机实际上每个端口的带宽
比集线器端口可用带宽要高许多，也就决定了交换机的传输速度比集线器要快许多。交换机在传输数据时是并行传输，多个端口对之间可
以同时传输数据，或者一个端口内的各台计算机之间的交换数据不会影响到另外一个端口内的数据通信。

* 传输模式不同

集线器只能采用半双工方式进行传输的，因为集线器是共享传输介质的，这样在上行通道上集线器一次只能传输一个任务，要么是接收数
据，要么是发送数据。交换机可以是半双工操作，也可以是全双工操作。

集线器工作于物理层，每个端口相当于一个中继器，原理很简单，只对物理电信号放大中继，所有端口同属一个冲突域，主要用来延伸
网络访问距离，扩展终端数量。因此, 集线器不能隔离冲突域.

交换机工作于数据链路层，它的每个端口相当于一个集线器，原理是根据数据帧头的 MAC 地址转发帧到合适的端口，每个端口是一个
独立的冲突域。因此, 交换机可以隔离冲突域

打个比方,
集结器相当于一个大办公区，两个人之间沟通必然会干扰其他人，影响效率，同时也没有私密性。而交换机相当于每个人都在独立的办公室，
沟通只需要根据办公室门牌号（MAC地址）找到本人，在办公室私聊就可以了，影响的只是办公室外面走廊（背板带宽）。



打个比方一个8口 hub，当端口 1 上的机器要给端口 8 上的机器发数据，那这个数据是这样跑的：首先她在端口 1 上侦听 hub 上有没有数
据在传输，如果没有，端口 1 就跳出来向 hub 上喊：“我有数据包要给端口8，请端口8听到后回话”, 这个数据被以广播的方式发送到 hub
上的其余 7 个口上，每端口都会接到这样的数据包，然后端口2－－－端口7会发一则消息给端口口1：“我不是端口8，请你快 tmd 释放带宽资源”
与此同时端口8会发消息给断口 1：“我是端口 8，你在找我吗？”端口 1 收到上述消息后，会和端口 8 进行确认，然后他们建立传输链接，
完成数据转发。等如果端口 1 在发送寻找断口 8 的消息后，没有得到相应，那她还会接着发这个消息，直到收到端口 8 的回答。等端口 1
和端口 8 完整数据转发后，假设他们还要进行通讯，那么 hub 上还会重复以上的过程。由此可见hub的通信方式点点碰撞，一个数据，需要
送达所有的端口，这不但增加了数据转发的时间，更要命的是hub往往会给网络带来可怕的广播风暴。

##背板带宽 VS 交换网板

所谓背板，是机框背部内侧的一块板子，上有到所有线卡的连接，提供线卡的供电、数据、管理、控制平面的各种通道。现在的
交换机，为了提高背板器件可用性，一般不会在背板上设计芯片，而全部是硬件链路，将器件故障率降低。背板带宽说的就是背
板所能提供的数据通道的带宽。

交换机上交换网板，用来进行跨线卡转发的数据交换。从线卡A到线卡B的数据转发路径是线卡A->背板->交换网板->背板->线卡B。
交换网板上一般会有一个或者多个交换芯片，交换机芯片通过交换网板内部链路、背板与各个线卡相连，提供线卡之间的数据交换。
交换容量就是指交换网板所能提供的数据交换能力。

背板，相当于公路，或者是一根（多条物理连接）连接线卡与交换网的网线；而交换网板，则是框式交换机的引擎。背板带宽一般
会远远超出当前交换能力需求，然而背板容量再大，道路再宽，交换网板也就是引擎不给力车子也是跑不快的。

总而言之，一句话：交换容量可以看做是交换机当前的一个整体性能指标，而背板带宽则说明了该机框具备的未来性能提升的空间。
